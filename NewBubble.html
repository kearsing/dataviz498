<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Artist Song Lyrics</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
@import url('https://fonts.googleapis.com/css2?family=Ranchers&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap');

@font-face {
  font-family: The Beatles;
  src: url(Beatles_Font.TTF);
}

@font-face {
  font-family: Bob Dylan;
  font-weight: bold;
  src: url(IndieFlower.ttf);
  
}
.bar { fill: steelblue; }
.tick { fill: black; }

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 150px;					
    height: 45px;					
    padding: 2px;				
    font: 20px sans-serif;		
    background: white;	
    border: 5px;
	border-color: black;
    border-radius: 8px;			
    pointer-events: none;			
}
</style>
</head>
<body onload="updateData('beatles.csv','The Beatles')">
<div id="chart1">
    <input name="updateButton1" 
           type="button" 
           value="The Beatles" 
           onclick="updateData('beatles.csv','The Beatles')" />
		   
	<input name="updateButton2" 
           type="button" 
           value="Bob Dylan" 
           onclick="updateData('dylan.csv', 'Bob Dylan')" />
		   
	<input name="updateButton3" 
           type="button" 
           value="Bruce Springsteen" 
           onclick="updateData('bruce1.csv','Bruce Springsteen')" />

</div>
<div id="divTitle"><h2 id = "pTitle">Top Words in Songs by the </h2></div>


<script src="https://d3js.org/d3.v5.min.js"></script>
<script>


var diameter = 500, //max size of the bubbles
    format   = d3.format(",d");

var bubble = d3.pack()
    .size([diameter, diameter])
    .padding(1.5);

var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);

// ** Update data section (Called from the onclick)
function updateData(SongFile, Font) {



if (Font == "The Beatles"){
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: #ad0052;font-size: 30pt;font-family: The Beatles;'>The Beatles</span>");
		var color = d3.scaleOrdinal(["#ffa200","#719a2e","#ad0052","#ea2c01","#eac016","#156eb7","#dc317e"]);
	}
	else if (Font == "Bob Dylan"){
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: #2A9CBE;font-size: 30pt;font-family: Indie Flower;'>" + Font + "</span>");
		var color    = d3.scaleOrdinal(["#304377","#3355FF","#3377FF","#3393FF","#33B8FF", "#33DAFF", "#2A9CBE"]);
	}
	else {
	d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='font-size: 30pt;font-family: Indie Flower;'>" + Font + "</span>");
	var color    = d3.scaleOrdinal(["#26466D","#506987","#ff453a","#5190ED"]);
	}
	

d3.csv(SongFile).then(function(data){

//clear existing charts 
	d3.selectAll("svg").remove();

//svg for Bubble chart	
	var svg = d3.select("body")
    .append("svg")
	.attr("id","svgBubble")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");
	
// set the dimensions and margins of the bar graph
var margin = {top: 20, right: 20, bottom: 60, left: 40},
    width = 600 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

//svg for the bar graph
var svg2 = d3.select("body").append("svg")
	.attr("id","svgBar")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

    //convert numerical values from strings to numbers
    data = data.map(function(d){ d.value = +d["Count"]; return d; });

    //Sets up a hierarchy of data object
    var root = d3.hierarchy({children:data})
      .sum(function(d) { return d.value; })
      .sort(function(a, b) { return b.value - a.value; });

    //Once we have hierarchal data, run bubble generator
    bubble(root);

    //setup the bubble chart
	d3.select("body").transition();
    var bubbles = svg.selectAll(".bubble")
        .data(root.children)
        .enter();

    //create the bubbles
    bubbles.append("circle")
		.transition()
		.duration(750)
        .attr("class", "circle")
        .attr("r", function(d){ return d.r; })
        .attr("cx", function(d){ return d.x; })
        .attr("cy", function(d){ return d.y; })
        //.style("fill", function(d) { return color(d.value); });
		.attr("fill", function(d, i) { return color(i); })
		

    //format the text for each bubble
    bubbles.append("text")
		//.data(data)
		.transition()
		.duration(900)
        .attr("x", function(d){ return d.x; })
        .attr("y", function(d){ return d.y + 5; })
        .attr("text-anchor", "middle")
	    .text(function(d){ return d.data["Name"]; })
        .style("fill","white")
        .style("font-family", Font)
		.style("font-size", "20px");
		
// bar chart code		


var x = d3.scaleBand()
  .range([ 0, width ])
  .domain(data.map(function(d) { return d.Name; }))
  .padding(0.2);
svg2.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x))
  .selectAll("text")
    .attr("transform", "translate(-10,0)rotate(-45)")
	.style("font-size",15)
    .style("text-anchor", "end");

// Add Y axis
var y = d3.scaleLinear()
  .domain([0, d3.max(data, function(d) { return d.value; })])
  .range([ height, 0]);
  
svg2.append("g")
	.style("font-size",15)
  .call(d3.axisLeft(y));
var tooltip = d3.select("body").append("div").attr("class", "toolTip");
// Bars
svg2.selectAll("mybar")
  .data(data)
  .enter()
  .append("rect")
    .attr("x", function(d) { return x(d.Name); })
    .attr("width", x.bandwidth())
	.attr("fill", function(d, i) { return color(i); })

    //.attr("fill", color)
    // no bar at the beginning thus:
    .attr("height", function(d) { return height - y(0); }) // always equal to 0
    .attr("y", function(d) { return y(0); })
		.on("mouseover", function(d) {		
				div.transition()		
					.duration(200)		
					.style("opacity", .9);		
				div.html("Count of '" + d.Name + "': " +(d.value))	
					.style("left", (d3.event.pageX) + "px")		
					.style("top", (d3.event.pageY - 28) + "px");	
            })					
        .on("mouseout", function(d) {		
				div.transition()		
					.duration(500)		
					.style("opacity", 0);	
});
// Animation
svg2.selectAll("rect")
  .transition()
  .duration(400)
  .attr("y", function(d) { return y(d.value); })
  .attr("height", function(d) { return height - y(d.value); })
  .delay(function(d,i){console.log(i) ; return(i*100)})


});
}

</script>
</body>
</html>