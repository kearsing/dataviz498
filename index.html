<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Artist Song Lyrics</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="myStyles.css">
</head>
<style>
</style>
<body >
<div id="chart1">
    <input 
			id="Beatles" 
			name="updateButton1" 
           type="button" autofocus
			class="beatlesbutton"		   
           value="The Beatles" 
           onclick="updateData('Beatles','The Beatles')" />
		   
	<input name="updateButton2" 
           type="button" 
		   class="dylanbutton"
           value="Bob Dylan" 
		 
           onclick="updateData('Dylan', 'Bob Dylan')" />
		   
	<input name="updateButton3" 
           type="button" 
		   class="brucebutton"
           value="Bruce Springsteen" 
           onclick="updateData('BruceS','Bruce Springsteen')" />
		   
	<input name="updateButton4" 
           type="button" 
		   class="eminembutton"
           value="Eminem" 
           onclick="updateData('Eminem','EMINEM')" />
		   
	<input name="updateButton5" 
			id="Miranda" 
           type="button" 
		   class="mirandabutton"
           value="Lin-Manuel Miranda (Hamilton)" 
           onclick="updateData('Miranda','Lin-Manuel Miranda')" />

</div>
<p id = "Band" hidden>Band</p>
<p id = "Mode" hidden>Mode</p>
<p id = "shortBand" hidden>shortBand</p>
<div id = "divIntro"><p>Music is one of humanties ancient ways of telling stories about people, places, and things.  $BAND NAME$ did this with $COUNT OF WORDS$ and $UNIQUE WORDS$.</p> </div>

<p><introWeak>Song lyrics from <a href = https://www.kaggle.com/paultimothymooney/poetry>Kaggle Song Lyrics</a>. Common stopwords removed. Analysis done in Python with <a href = https://spacy.io/usage/linguistic-features#named-entities>Spacy NER</a>, Visuals done with <a href=https://d3js.org>D3.js</a>. <br> <a href=https://en.wikipedia.org/wiki/Natural_language_processing>NLP</a> is not a perfect science, hence data is meant to be a close approximation.</introWeak></p>
<div class="container">
  <form>
    <label class="radio-inline">
      <input type="radio" name="optradio" id="Words" checked onclick="fireUp()" >Words
    </label>
    <label class="radio-inline">
      <input type="radio" name="optradio" id = "People" onclick="fireUp()">People
    </label>
    <label class="radio-inline">
      <input type="radio" id="Places" name="optradio" onclick="fireUp()">Places
    </label>
	    <label class="radio-inline">
      <input type="radio" name="optradio" id="Things" onclick="fireUp()">Things
    </label>
  </form>
</div>
<div id="divTitle"><h2 id = "pTitle">Top Words in Songs by the </h2></div>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script>



document.getElementById("Beatles").click();

function fireUp() {

var sB = document.getElementById("shortBand").innerHTML;
var B = document.getElementById("Band").innerHTML;

updateData(sB,B);
}

function checkMode() { 
	
			if (typeof selectedBand == 'undefined'){
				selectedBand = "Miranda";
			}
			thisBand = document.getElementById("Band").innerHTML;
            var ele = document.getElementsByName('optradio'); 
            mode = "";
            for(i = 0; i < ele.length; i++) { 
                if(ele[i].checked)
				mode = ele[i].id;		
              
            } 
			document.getElementById("Mode").innerHTML = mode; 
			
			//return mode;
			
        } 


var diameter = 500, //max size of the bubbles
    format   = d3.format(",d");

var bubble = d3.pack()
    .size([diameter, diameter])
    .padding(1.5);

var div = d3.select("body").append("div")	
    .attr("class", "tooltip")				
    .style("opacity", 0);



// ** Update data section (Called from the onclick)
function updateData(shortBand, Band) {

document.getElementById("Band").innerHTML = Band; 
document.getElementById("shortBand").innerHTML = shortBand;
checkMode();
thisMode = document.getElementById("Mode").innerHTML;
SongFile = "Data/" + shortBand + "_" + thisMode + ".csv"





if (Band == "The Beatles"){
		var totalWords = 14340
		var uniqueWords = 2197
		var approxSongs = 213
		d3.select("#divIntro").html("<p>Music is an ancient way of telling stories about people, places, and things.  <introBeatles> " + Band + "</introBeatles> did this with <introBeatles> " + totalWords + "</introBeatles> total words and <introBeatles> " + uniqueWords + "</introBeatles> unique words in approximately <introBeatles> " + approxSongs + "</introBeatles> songs. Below you can see their top words, top people, places, and things mentioned in their lyrics.</p>");
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: #ad0052;font-size: 30pt;font-family: The Beatles;'>The Beatles</span>");
		var color = d3.scaleOrdinal(["#ffa200","#719a2e","#ad0052","#ea2c01","#eac016","#156eb7","#dc317e"]);
	}
	else if (Band == "Bob Dylan"){
		var totalWords = 38203
		var uniqueWords = 5983
		var approxSongs = 500
		d3.select("#divIntro").html("<p>Music is an ancient way of telling stories about people, places, and things.  <introDylan> " + Band + "</introDylan> did this with <introDylan> " + totalWords + "</introDylan> total words and <introDylan> " + uniqueWords + "</introDylan> unique words in approximately <introDylan> " + approxSongs + "</introDylan> songs. Below you can see their top words, top people, places, and things mentioned in their lyrics.</p>");
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: #2A9CBE;font-size: 30pt;font-family: Indie Flower;'>" + Band + "</span>");
		var color    = d3.scaleOrdinal(["#304377","#3355FF","#3377FF","#3393FF","#33B8FF", "#33DAFF", "#2A9CBE"]);
	}
	else if (Band == "Bruce Springsteen"){
		var totalWords = 21471
		var uniqueWords = 3217
		var approxSongs = 327
		d3.select("#divIntro").html("<p>Music is an ancient way of telling stories about people, places, and things.  <introBruce> " + Band + "</introBruce> did this with <introBruce> " + totalWords + "</introBruce> total words and <introBruce> " + uniqueWords + "</introBruce> unique words in approximately <introBruce> " + approxSongs + "</introBruce> songs. Below you can see their top words, top people, places, and things mentioned in their lyrics.</p>");
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: #26466D;font-size: 30pt;font-family: "+ Band +";'>" + Band + "</span>");
		var color    = d3.scaleOrdinal(["#26466D","#506987","#ff453a","#5190ED"]);
		}
	else if (Band == "EMINEM"){
		var totalWords = 64484
		var uniqueWords = 9125
		var approxSongs = 330
		d3.select("#divIntro").html("<p>Music is an ancient way of telling stories about people, places, and things.  <introEminem> " + Band + "</introEminem> did this with <introEminem> " + totalWords + "</introEminem> total words and <introEminem> " + uniqueWords + "</introEminem> unique words in approximately <introEminem> " + approxSongs + "</introEminem> songs. Below you can see their top words, top people, places, and things mentioned in their lyrics.</p>");
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: black;font-size: 30pt;font-family: Helvetica;'>" + Band + "</span>");
		var color    = d3.scaleOrdinal(["Black","Black","Black","Red","Black", "Black", "Red"]);
	}
	else if (Band == "Lin-Manuel Miranda"){
		var totalWords = 11208
		var uniqueWords = 1970
		var approxSongs = 46
		d3.select("#divIntro").html("<p>Music is an ancient way of telling stories about people, places, and things.  <introMiranda> " + Band + "</introMiranda> did this with <introMiranda> " + totalWords + "</introMiranda> total words and <introMiranda> " + uniqueWords + "</introMiranda> unique words in approximately <introMiranda> " + approxSongs + "</introMiranda> songs. Below you can see their top words, top people, places, and things mentioned in their lyrics.</p>");
		d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='color: #e5a541;font-size: 30pt;font-family: "+ Band +";'>" + Band + "</span>");
		var color    = d3.scaleOrdinal(["#d29337","#070605","#7f4f20","#fad462","#663812", "#d6d4d2", "#e5a541"]);
	}
	else {
	d3.select("#pTitle").html("Top Words Used in Songs by " + "<span style='font-size: 30pt;font-family: Indie Flower;'>" + Band + "</span>");
	
	var color    = d3.scaleOrdinal(["#2b1d0e","#52361b","#4B5320","#AFAA44","#877E3D", "#800000", "#DAA520"]);
	}
	

d3.csv(SongFile).then(function(data){

//clear existing charts 
	d3.selectAll("svg").remove();

//svg for Bubble chart	
	var svg = d3.select("body")
    .append("svg")
	.attr("id","svgBubble")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");
	
// set the dimensions and margins of the bar graph
var margin = {top: 20, right: 20, bottom: 110, left: 60},
    width = 600 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

//svg for the bar graph
var svg2 = d3.select("body").append("svg")
	.attr("id","svgBar")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
	//.attr("viewBox", '0 0 540 420')
	
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

    //convert numerical values from strings to numbers
    data = data.map(function(d){ d.value = +d["Count"]; return d; });

    //Sets up a hierarchy of data object
    var root = d3.hierarchy({children:data})
      .sum(function(d) { return d.value; })
      .sort(function(a, b) { return b.value - a.value; });

    //Once we have hierarchal data, run bubble generator
    bubble(root);

    //setup the bubble chart
	d3.select("body").transition();
    var bubbles = svg.selectAll(".bubble")
        .data(root.children)
        .enter();

    //create the bubbles
    bubbles.append("circle")
		.transition()
		.duration(750)
        .attr("class", "circle")
        .attr("r", function(d){ return d.r; })
        .attr("cx", function(d){ return d.x; })
        .attr("cy", function(d){ return d.y; })
        //.style("fill", function(d) { return color(d.value); });
		.attr("fill", function(d, i) { return color(i); })
		

    //format the text for each bubble
    bubbles.append("text")
		//.data(data)
		.transition()
		.duration(900)
        .attr("x", function(d){ return d.x; })
        .attr("y", function(d){ return d.y + 5; })
        .attr("text-anchor", "middle")
	    .text(function(d){ return d.data["Name"]; })
        .style("fill","white")
        .style("font-family", Band)
		//.call(fontSize)
		.style("font-size", function(d) { return (d.r/d.data["Name"].length) + 5 +  "px"; })
		.attr("fake", d=> console.log(d.r, d.data["Name"].length));
		
	function fontSize(d){
		return d.r/2;
	
	}

		
// bar chart code		


var x = d3.scaleBand()
  .range([ 0, width ])
  .domain(data.map(function(d) { return d.Name; }))
  .padding(0.2);
svg2.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x))
  .selectAll("text")
    .attr("transform", "translate(-10,0)rotate(-45)")
	.style("font-size",15)
    .style("text-anchor", "end");

// Add Y axis
var y = d3.scaleLinear()
  .domain([0, d3.max(data, function(d) { return d.value; })])
  .range([ height, 0]);
  
svg2.append("g")
	.style("font-size",15)
  .call(d3.axisLeft(y));
var tooltip = d3.select("body").append("div").attr("class", "toolTip");
// Bars
svg2.selectAll("mybar")
  .data(data)
  .enter()
  .append("rect")
    .attr("x", function(d) { return x(d.Name); })
    .attr("width", x.bandwidth())
	.attr("fill", function(d, i) { return color(i); })

    //.attr("fill", color)
    // no bar at the beginning thus:
    .attr("height", function(d) { return height - y(0); }) // always equal to 0
    .attr("y", function(d) { return y(0); })
		.on("mouseover", function(d) {		
				div.transition()		
					.duration(200)		
					.style("opacity", .9);		
				div.html("Count of '" + d.Name + "': " +(d.value))	
					.style("left", (d3.event.pageX) + "px")		
					.style("top", (d3.event.pageY - 28) + "px");	
            })					
        .on("mouseout", function(d) {		
				div.transition()		
					.duration(500)		
					.style("opacity", 0);	
});
// Animation
svg2.selectAll("rect")
  .transition()
  .duration(400)
  .attr("y", function(d) { return y(d.value); })
  .attr("height", function(d) { return height - y(d.value); })
  .delay(function(d,i){console.log(i) ; return(i*100)})


});
}

</script>
</body>
</html>